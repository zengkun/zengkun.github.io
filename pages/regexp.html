<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Keywords" content="blog" />
    <meta name="Description" content="blog" />
    <title>学习笔记</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/main.css" />
</head>

<body>
    <div class="main">
        <div class="header">
            <ul id="pages">
                <li><a href="/">home</a></li>
                <li><a href="/#/tags">tags</a></li>
                <li><a href="/#/archive">archive</a></li>
            </ul>
        </div>
        <div class="wrap-header">
            <h1>
                <a href="/" id="title"></a>
            </h1>
        </div>
        <div id="md" style="display: none;">
        <!-- 不能有缩进 -->
<!-- markdown -->
### 问题背景：

今天在做 vue-note 关键字检索标题时，想通过输入关键字进行匹配，并给匹配到的关键词标红，开始使用循环存值再取出替换展示，会出现一个标题有多处时，关键词大小写匹配错乱，所以想到使用正则分组来匹配。

### 解决：
1、`new RegExp`
~~~~{javascript}
this.tempItems = this.items.filter((item) => {
	return item.title.toUpperCase().includes(this.searchKey.toUpperCase())
}).map((item, index) => {
	var vKey = this.searchKey;
	// 分组括号"()"用字符串拼接
	var regExp = new RegExp("(" + vKey + ")", "gim");
	return {
		"title": item.title.replace(regExp, '<span class="red">$1</span>'),
		"router": item.router
	};
})
~~~~

2、`eval`（下下策，不解释 ~_~）
~~~~{javascript}
var regExp = eval("/(" + vKey + ")/gim");
~~~~

<!-- markdown end -->
        </div>
        <div class="entry" id="main">
        <!-- 不能有缩进 -->
<!-- content -->
<h3 id="">问题背景：</h3>

<p>今天在做 vue-note 关键字检索标题时，想通过输入关键字进行匹配，并给匹配到的关键词标红，开始使用循环存值再取出替换展示，会出现一个标题有多处时，关键词大小写匹配错乱，所以想到使用正则分组来匹配。</p>

<h3 id="">解决：</h3>

<p>1、<code>new RegExp</code></p>

<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>tempItems <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">filter<span class="token punctuation">(</span></span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> item<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">toUpperCase<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes<span class="token punctuation">(</span></span><span class="token keyword">this</span><span class="token punctuation">.</span>searchKey<span class="token punctuation">.</span><span class="token function">toUpperCase<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map<span class="token punctuation">(</span></span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> vKey <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>searchKey<span class="token punctuation">;</span>
   <span class="token comment" spellcheck="true"> // 分组括号"()"用字符串拼接
</span>    <span class="token keyword">var</span> regExp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">"("</span> <span class="token operator">+</span> vKey <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">,</span> <span class="token string">"gim"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string">"title"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">replace<span class="token punctuation">(</span></span>regExp<span class="token punctuation">,</span> <span class="token string">'&lt;span class="red"&gt;$1&lt;/span&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"router"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>router
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>

<p>2、<code>eval</code>（下下策，不解释 ~_~）</p>

<pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword">var</span> regExp <span class="token operator">=</span> <span class="token function">eval<span class="token punctuation">(</span></span><span class="token string">"/("</span> <span class="token operator">+</span> vKey <span class="token operator">+</span> <span class="token string">")/gim"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<!-- content end -->
        </div>
        <br>
        <br>
        <div id="disqus_thread"></div>
        <div class="footer">
            <p>© Copyright 2017 <a href="mailto:zengkun0415@sina.com"> zengkun0415@sina.com</a></p>
        </div>
    </div>
    <script src="/main.js"></script>
    <script id="content" type="text/mustache">
        <h1>{{title}}</h1>
        <div class="tag">
            {{date}} by {{author}} {{#tags}}
            <a href="/#/tag/{{name}}">#{{name}}</a> {{/tags}}
        </div>
    </script>
    <script id="pagesTemplate" type="text/mustache">
        {{#pages}}
        <li>
            <a href="{{path}}">{{title}}</a>
        </li>
        {{/pages}}
    </script>
    <script>
    $(document).ready(function() {
        $.ajax({
            url: "/main.json",
            type: "GET",
            dataType: "json",
            success: function(data) {
                $("#title").html(data.name);
                var pagesTemplate = Hogan.compile($("#pagesTemplate").html());
                var pagesHtml = pagesTemplate.render({
                    "pages": data.pages
                });
                $("#pages").append(pagesHtml);
                //path
                var path = "pages/regexp.html";
                //path end
                var now = 0;
                for (var i = 0; i < data.posts.length; ++i)
                    if (path == data.posts[i].path)
                        now = i;
                var post = data.posts[now];
                var tmp = post.tags.split(" ");
                var tags = [];
                for (var i = 0; i < tmp.length; ++i)
                    if (tmp[i].length > 0)
                        tags.push({
                            "name": tmp[i]
                        });
                var contentTemplate = Hogan.compile($("#content").html());
                var contentHtml = contentTemplate.render({
                    "title": post.title,
                    "tags": tags,
                    "date": post.date,
                    "author": post.author ? post.author : data.name
                });
                $("#main").prepend(contentHtml);
            }
        });
    });
    </script>
    <script src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ["\\(", "\\)"]], processEscapes: true}});
    </script>
</body>

</html>
